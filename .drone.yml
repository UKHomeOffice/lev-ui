---
kind: pipeline
type: kubernetes
name: default

platform:
  os: linux
  arch: amd64

steps:
- name: docker-build
  pull: if-not-exists
  image: plugins/docker
  settings:
    dry_run: true
    repo: quay.io/ukhomeofficedigital/lev-web-ui
  when:
    event:
    - pull_request
    
  - name: push_to_quay
    image: plugins/docker
    settings:
      registry: quay.io
      repo: quay.io/ukhomeofficedigital/lev-web-ui
      tags:
        - "1.0.0-${DRONE_BUILD_NUMBER}-${DRONE_COMMIT:0:10}"
        - "1.0.0"
        - "1.0"
        - "latest"
    environment:
      DOCKER_PASSWORD:
        from_secret: QUAY_PASSWORD
      DOCKER_USERNAME: ukhomeofficedigital+lev_web_ui
    when:
      branch:
        - master
      event:
        - push

